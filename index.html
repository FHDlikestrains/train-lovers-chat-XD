<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ghaster Chat</title>


<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">


<style>
    body {
        margin: 0;
        background: black;
        font-family: "Press Start 2P", monospace;
        color: white;
        overflow: hidden;
    }


    .centered {
        width: 100%;
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 20px;
        text-align: center;
    }


    input, button {
        font-family: "Press Start 2P", monospace;
        padding: 10px 15px;
        background: #222;
        border: 2px solid white;
        color: white;
        width: 260px;
    }


    button:hover {
        background: white;
        color: black;
        cursor: pointer;
    }


    #chat {
        display: none;
        flex-direction: column;
        height: 100vh;
    }


    #chatTitle {
        font-size: 18px;
        margin: 10px;
        font-style: italic;
        text-align: center;
    }


    #messages {
        flex: 1;
        overflow-y: auto;
        padding: 15px;
        border-top: 2px solid white;
        border-bottom: 2px solid white;
    }


    .msg {
        margin-bottom: 20px;
        word-wrap: break-word;
    }


    #bottomBar {
        display: flex;
        padding: 10px;
        gap: 10px;
        border-top: 2px solid white;
    }


    #msgInput {
        flex: 1;
    }
</style>
</head>
<body>


<!-- SIGNUP -->
<div id="signup" class="centered">
    <h2>SIGN UP</h2>
    <input id="suUser" placeholder="Username">
    <input id="suPass" type="password" placeholder="Password">
    <button onclick="signup()">Create Account</button>
    <button onclick="showLogin()">Already have one?</button>
</div>


<!-- LOGIN -->
<div id="login" class="centered" style="display:none;">
    <h2>LOGIN</h2>
    <input id="liUser" placeholder="Username">
    <input id="liPass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="showSignup()">Create new one</button>
</div>


<!-- CHAT -->
<div id="chat">
    <div id="chatTitle">a group chat made of some extremely unserious and unfunny individuals</div>


    <div id="messages"></div>


    <div id="bottomBar">
        <input id="msgInput" placeholder="Type a message...">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>


<!-- Notification sound -->
<audio id="notif" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>


<script>
/* ---------------------------
   SIGN UP
--------------------------- */
function signup() {
    let u = suUser.value.trim();
    let p = suPass.value.trim();


    if (!u || !p) return alert("Fill both boxes.");


    if (localStorage.getItem("user_" + u))
        return alert("Someone already took that username.");


    localStorage.setItem("user_" + u, p);
    alert("Account created! Login now.");
    showLogin();
}


/* ---------------------------
   LOGIN
--------------------------- */
function login() {
    let u = liUser.value.trim();
    let p = liPass.value.trim();


    let stored = localStorage.getItem("user_" + u);


    if (!stored) return alert("User doesn't exist.");
    if (stored !== p) return alert("Wrong password.");


    localStorage.setItem("currentUser", u);


    startChat();
}


/* ---------------------------
   SHOW FORMS
--------------------------- */
function showSignup() {
    signup.style.display = "flex";
    login.style.display = "none";
}
function showLogin() {
    signup.style.display = "none";
    login.style.display = "flex";
}


/* ---------------------------
   CHAT LOADING
--------------------------- */
function startChat() {
    signup.style.display = "none";
    login.style.display = "none";
    chat.style.display = "flex";


    loadMessages();
}


/* ---------------------------
   SEND MESSAGE
--------------------------- */
function sendMessage() {
    let txt = msgInput.value.trim();
    if (!txt) return;


    let user = localStorage.getItem("currentUser");
    let msg = { user, txt, time: Date.now() };


    let data = JSON.parse(localStorage.getItem("messages") || "[]");
    data.push(msg);
    localStorage.setItem("messages", JSON.stringify(data));


    msgInput.value = "";
    loadMessages(true);
}


/* ---------------------------
   LOAD + DISPLAY MESSAGES
--------------------------- */
function loadMessages(playSound=false) {
    let data = JSON.parse(localStorage.getItem("messages") || "[]");


    messages.innerHTML = "";
    data.forEach(m => {
        let div = document.createElement("div");
        div.className = "msg";
        div.innerHTML = `<b>${m.user}</b>: ${m.txt}`;
        messages.appendChild(div);
    });


    messages.scrollTop = messages.scrollHeight;


    if (playSound) document.getElementById("notif").play();
}
</script>


</body>
</html>